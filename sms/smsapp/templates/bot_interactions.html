{% extends 'base.html' %}
{% block head %}
<style>
    .chat-container {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        padding: 20px;
        max-height: 600px;
        overflow-y: auto;
    }
    .message {
        max-width: 70%;
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 10px;
        clear: both;
        position: relative;
    }
    .message-df {
        background-color: #e5f3ff;
        float: left;
        margin-right: auto;
    }
    .message-messages {
        background-color: #dcf8c6;
        float: right;
        margin-left: auto;
    }
    .message-timestamp {
        font-size: 0.7em;
        color: #888;
        text-align: right;
        margin-top: 5px;
    }
</style>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
{% endblock %}
{% block content %}

<center><h3 class="mt-2">Bot Interactions</h3></center>

<div class="chat-container">
    {% for item in combined_data %}
        <div class="message {% if item.source == 'df' %}message-df{% else %}message-messages{% endif %}">
            {% if item.message_body %}
                <div>{{ item.message_body }}</div>
                <div class="message-timestamp">
                    {% if item.source == 'df' and item.Date %}
                        {{ item.Date|date:"M d, Y H:i" }}
                    {% elif item.source == 'messages' and item.created_at %}
                        {{ item.created_at|date:"M d, Y H:i" }}
                    {% endif %}
                </div>
            {% endif %}

            {% if item.created_at %}
                <div class="message-timestamp">
                    {% if item.source == 'messages' and item.created_at %}
                        {{ item.created_at|date:"M d, Y H:i" }}
                    {% endif %}
                </div>
                {% if item.message_type == 'send_text_message' %}
                <div>
                    <p>{{ item.body }}</p>
                </div>
                {% endif %}
                {% if item.message_type == 'list_message' %}
                    <div>
                        <strong>{{ item.body }}</strong>
                        {% for section in item.sections %}
                            <div>{{ section.title }}</div>
                            {% for row in section.rows %}
                                <div>
                                    {{ row.title }} - {{ row.description }}
                                </div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                {% endif %}
            {% endif %}
        </div>
    {% endfor %}
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
{% endblock %}